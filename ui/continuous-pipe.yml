tasks:
    images:
        build:
            services:
                ui:
                    steps:
                        - docker_file_path: ./docker/build/Buildfile
                          write_artifacts:
                              - name: dist
                                path: /app/dist
                        - docker_file_path: ./docker/build/Productionfile
                          image: inviqasession/cp-river-ui
                          read_artifacts:
                              - name: dist
                                path: /dist

    production:
        deploy:
            cluster: ${CLUSTER}
            environment:
                name: '"ui-" ~ code_reference.branch'

            services:
                ui:
                    endpoints:
                        -
                            name: https
                            type: NodePort
                            ssl_certificates:
                                -
                                    name: continuouspipeio
                                    cert: ${WILDCARD_SSL_CERT}
                                    key: ${WILDCARD_SSL_KEY}

                    specification:
                        environment_variables:
                            - name: AUTHENTICATOR_API_URL
                              value: authenticator.continuouspipe.io
                            - name: LOG_STREAM_URL
                              value: logstream.continuouspipe.io
                            - name: PIPE_API_URL
                              value: pipe.continuouspipe.io
                            - name: RIVER_API_URL
                              value: river.continuouspipe.io
                            - name: SENTRY_DSN
                              value: http://cca81e898c654780baac3dfae5c67cc3@sentry.tools.sroze.io/16
