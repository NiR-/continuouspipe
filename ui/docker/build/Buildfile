FROM nginx

# Install NodeJS
RUN apt-get update \
 && apt-get install -y curl \
 && curl -sL https://deb.nodesource.com/setup_5.x | bash - \
 && apt-get install -y nodejs build-essential

# Install prerequisites build tools
RUN apt-get install -y ruby ruby-dev build-essential git \
  && gem install --no-rdoc --no-ri sass -v 3.4.22 \
  && gem install --no-rdoc --no-ri compass \
  && npm install -g grunt-cli bower

# Build the application
RUN mkdir /app
WORKDIR /app

# Install node dependencies
ADD package.json /app/package.json
RUN npm install

# Install bower dependencies
ADD .bowerrc /app/.bowerrc
ADD bower.json /app/bower.json
RUN bower install --config.interactive=false --allow-root

# Build the code
COPY . /app
RUN grunt build
