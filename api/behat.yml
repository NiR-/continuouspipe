default:
    suites:
        river_domain:
            paths:
                - %paths.base%/features/river/domain/

            contexts:
                - River\SecurityContext:
                    - "@security.token_storage"
                    - "@security.authenticator.client.in_memory"
                    - "@kernel"
                    - "@security.encryption.vault.previously_known"
                    - "@lexik_jwt_authentication.jwt_manager"
                    - "@jms_serializer"
                - River\TideConfigurationContext:
                    - "@river.tide_configuration_factory"
                - River\TideContext:
                    - "@command_bus"
                    - "@event_bus"
                    - "@river.tide_event_store"
                    - "@river.tide_factory"
                    - "@river.view.tide_repository"
                    - "@kernel"
                    - "@continuouspipe.message.default.message_producer.traced"
                    - "@river.time_resolver.predictable"
                    - "@river.repository.tide"
                    - "@continuouspipe.message.delayed.message_producer.delayed_messages_buffer"
                - River\Tide\TasksContext:
                    - "@event_bus"
                    - "@river.repository.tide"
                - River\LoggingContext:
                    - "@kernel"
                    - "@log_stream.client.in_memory"
                    - "@logger"
                - River\CodeRepositoriesContext:
                    - "@river.commit_resolver.predictable"
                    - "@event_bus"
                    - "@river.tide_event_store"
                    - "@river.code_repository.branch_query.in_memory"
                    - "@river.code_repository.local_filesystem_resolver"
                    - "@river.code_repository.code_archive_streamer.overwritten"
                    - "@river.code_repository.partially_overwritten_filesystem_resolver"
                - River\FlowContext:
                    pipeClient: "@river.pipe_client.fake"
                    hookablePipeClient: "@river.hookable_pipe_client"
                    traceablePipeClient: "@river.pipe_client"
                    kernel: "@kernel"
                    flowRepository: "@river.repository.flow"
                    codeRepositoryRepository: "@repository_river.code_repository_repository"
                    authenticatorClient: "@security.authenticator.client.in_memory"
                    teamRepository: "@authenticator.team_repository"
                    eventBus: "@event_bus"
                    serializer: "@jms_serializer"
                    tracedUsageHistoryRepository: "@river.managed.resources.history_repository.traced"
                    commandBus: "@command_bus"
                - River\Task\BuildContext:
                    - "@builder.client"
                    - "@builder.client.traceable"
                    - "@builder.client.hookable"
                    - "@river.tide_event_store"
                    - "@event_bus"
                    - "@kernel"
                    - "@jms_serializer"
                    - "@tolerance.metrics.publisher.statsd"
                - River\Task\DeployContext:
                    - "@river.tide_event_store"
                    - "@event_bus"
                    - "@river.pipe_client"
                    - "@river.task.deploy.naming.environment_strategy"
                    - "@kernel"
                    - "@jms_serializer"
                    - "@river.flow.environment_client.callback"
                - River\Task\RunContext:
                    - "@kernel"
                    - "@river.pipe_client"
                    - "@jms_serializer"
                - River\Task\WaitContext: ~
                - River\Task\ManualApprovalContext:
                    - "@kernel"
                - River\TeamContext:
                    - "@kernel"
                    - "@authenticator.team_repository"
                - River\TideSummaryContext:
                    - "@kernel"
                - River\AnalyticsContext:
                    - "@river.keen.client.traceable"
                    - "@river.logitio.client.traceable"
                - River\NotificationsContext:
                    - "@river.notifications.notifier.slack.traceable"
                - River\Task\WebHookContext:
                    - "@river.web_hooks.client.traceable"
                    - "@river.web_hooks.client.hookable"
                - River\ClusterHealthContext:
                    - "@river.k8s_health_checker.http.guzzle_client.stack"
                    - "@kernel"
                - River\FirebaseContext:
                    - "@csa_guzzle.data_collector.history_bag"
                - River\UserActivityContext:
                    - "@river.user_activity.traceable_dispatcher"
                    - "@river.user_activity.middleware_supporting_dispatcher"
                - River\DevelopmentEnvironmentContext:
                    - "@kernel"
                    - "@event_bus"
                - River\BranchContext:
                    - "@command_bus"
                - River\QuayIoContext:
                    - "@csa_guzzle.data_collector.history_bag"

                # TBR:
                - River\GitHubContext:
                    - "@kernel"
                    - "@river.notifications.notifier.github.commit_status.traceable"
                    - "@river.pull_request_resolver"
                    - "@river.pipe_client"
                    - "@river.tide_event_store"
                    - "@river.github.http_client"
                    - "@github.integration.in_memory_installation_repository"
                    - "@github.integration.traceable_installation_repository"
                    - "@github.integration.installation_repository"
                    - "@github.integration.traceable_installation_token_resolver"
                    - "@github.integration.installation_token_resolver.in_memory"
                    - "@github.integration.installation_token_resolver"
                    - "@repository_river.code_repository_repository"
                    - "@river.github.guzzle_http_client.handler.matching"
                    - "@river.code_repository.branch_query.in_memory"

                - River\StorageContext:
                    - "@river.pipeline.view.storage"
                    - "@river.repository.flow"
                    - "@kernel"

        river_github:
            paths:
                - %paths.base%/features/river/integrations/code-repositories/common/
                - %paths.base%/features/river/integrations/code-repositories/github/

            contexts:
                - River\CacheContext:
                    - "@river.cache"

                # GitHub-specific contexts
                - River\GitHubContext:
                    - "@kernel"
                    - "@river.notifications.notifier.github.commit_status.traceable"
                    - "@river.pull_request_resolver"
                    - "@river.pipe_client"
                    - "@river.tide_event_store"
                    - "@river.github.http_client"
                    - "@github.integration.in_memory_installation_repository"
                    - "@github.integration.traceable_installation_repository"
                    - "@github.integration.installation_repository"
                    - "@github.integration.traceable_installation_token_resolver"
                    - "@github.integration.installation_token_resolver.in_memory"
                    - "@github.integration.installation_token_resolver"
                    - "@repository_river.code_repository_repository"
                    - "@river.github.guzzle_http_client.handler.matching"
                    - "@river.code_repository.branch_query.in_memory"

                # Common contexts
                - River\SecurityContext:
                    - "@security.token_storage"
                    - "@security.authenticator.client.in_memory"
                    - "@kernel"
                    - "@security.encryption.vault.previously_known"
                    - "@lexik_jwt_authentication.jwt_manager"
                    - "@jms_serializer"
                - River\TideConfigurationContext:
                    - "@river.tide_configuration_factory"
                - River\TideContext:
                    - "@command_bus"
                    - "@event_bus"
                    - "@river.tide_event_store"
                    - "@river.tide_factory"
                    - "@river.view.tide_repository"
                    - "@kernel"
                    - "@continuouspipe.message.default.message_producer.traced"
                    - "@river.time_resolver.predictable"
                    - "@river.repository.tide"
                    - "@continuouspipe.message.delayed.message_producer.delayed_messages_buffer"
                - River\Tide\TasksContext:
                    - "@event_bus"
                    - "@river.repository.tide"
                - River\LoggingContext:
                    - "@kernel"
                    - "@log_stream.client.in_memory"
                    - "@logger"
                - River\CodeRepositoriesContext:
                    - "@river.commit_resolver.predictable"
                    - "@event_bus"
                    - "@river.tide_event_store"
                    - "@river.code_repository.branch_query.in_memory"
                    - "@river.code_repository.local_filesystem_resolver"
                    - "@river.code_repository.code_archive_streamer.overwritten"
                    - "@river.code_repository.partially_overwritten_filesystem_resolver"
                - River\FlowContext:
                    pipeClient: "@river.pipe_client.fake"
                    hookablePipeClient: "@river.hookable_pipe_client"
                    traceablePipeClient: "@river.pipe_client"
                    kernel: "@kernel"
                    flowRepository: "@river.repository.flow"
                    codeRepositoryRepository: "@repository_river.code_repository_repository"
                    authenticatorClient: "@security.authenticator.client.in_memory"
                    teamRepository: "@authenticator.team_repository"
                    eventBus: "@event_bus"
                    serializer: "@jms_serializer"
                    tracedUsageHistoryRepository: "@river.managed.resources.history_repository.traced"
                    commandBus: "@command_bus"
                - River\Task\BuildContext:
                    - "@builder.client"
                    - "@builder.client.traceable"
                    - "@builder.client.hookable"
                    - "@river.tide_event_store"
                    - "@event_bus"
                    - "@kernel"
                    - "@jms_serializer"
                    - "@tolerance.metrics.publisher.statsd"
                - River\Task\DeployContext:
                    - "@river.tide_event_store"
                    - "@event_bus"
                    - "@river.pipe_client"
                    - "@river.task.deploy.naming.environment_strategy"
                    - "@kernel"
                    - "@jms_serializer"
                    - "@river.flow.environment_client.callback"
                - River\Task\RunContext:
                    - "@kernel"
                    - "@river.pipe_client"
                    - "@jms_serializer"
                - River\Task\WaitContext: ~
                - River\Task\ManualApprovalContext:
                    - "@kernel"
                - River\TideSummaryContext:
                    - "@kernel"
                - River\AnalyticsContext:
                    - "@river.logitio.client.traceable"
                    - "@river.keen.client.traceable"
                - River\NotificationsContext:
                    - "@river.notifications.notifier.slack.traceable"
                - River\Task\WebHookContext:
                    - "@river.web_hooks.client.traceable"
                    - "@river.web_hooks.client.hookable"
                - River\ClusterHealthContext:
                    - "@river.k8s_health_checker.http.guzzle_client.stack"
                    - "@kernel"
                - River\FirebaseContext:
                    - "@csa_guzzle.data_collector.history_bag"
                - River\UserActivityContext:
                    - "@river.user_activity.traceable_dispatcher"
                    - "@river.user_activity.middleware_supporting_dispatcher"
                - River\QuayIoContext:
                    - "@csa_guzzle.data_collector.history_bag"

        river_bitbucket:
            paths:
                - %paths.base%/features/river/integrations/code-repositories/common/
                - %paths.base%/features/river/integrations/code-repositories/bitbucket/

            contexts:
                # BitBucket-specific contexts
                - River\BitBucketContext:
                    - "@river.code_repository.bitbucket.explorer.http_client.handler.matching"
                    - "@kernel"
                    - "@atlassian_addon.installation_repository.traceable"
                    - "@jms_serializer"
                    - "@river.bitbucket.client_factory"
                    - "@csa_guzzle.data_collector.history_bag"
                    - "@repository_river.code_repository_repository"
                    - "@river.code_repository.branch_query.in_memory"
                    - "@river.pull_request_resolver"

                # Common contexts
                - River\SecurityContext:
                    - "@security.token_storage"
                    - "@security.authenticator.client.in_memory"
                    - "@kernel"
                    - "@security.encryption.vault.previously_known"
                    - "@lexik_jwt_authentication.jwt_manager"
                    - "@jms_serializer"
                - River\TideConfigurationContext:
                    - "@river.tide_configuration_factory"
                - River\TideContext:
                    - "@command_bus"
                    - "@event_bus"
                    - "@river.tide_event_store"
                    - "@river.tide_factory"
                    - "@river.view.tide_repository"
                    - "@kernel"
                    - "@continuouspipe.message.default.message_producer.traced"
                    - "@river.time_resolver.predictable"
                    - "@river.repository.tide"
                    - "@continuouspipe.message.delayed.message_producer.delayed_messages_buffer"
                - River\Tide\TasksContext:
                    - "@event_bus"
                    - "@river.repository.tide"
                - River\LoggingContext:
                    - "@kernel"
                    - "@log_stream.client.in_memory"
                    - "@logger"
                - River\CodeRepositoriesContext:
                    - "@river.commit_resolver.predictable"
                    - "@event_bus"
                    - "@river.tide_event_store"
                    - "@river.code_repository.branch_query.in_memory"
                    - "@river.code_repository.local_filesystem_resolver"
                    - "@river.code_repository.code_archive_streamer.overwritten"
                    - "@river.code_repository.partially_overwritten_filesystem_resolver"
                - River\FlowContext:
                    pipeClient: "@river.pipe_client.fake"
                    hookablePipeClient: "@river.hookable_pipe_client"
                    traceablePipeClient: "@river.pipe_client"
                    kernel: "@kernel"
                    flowRepository: "@river.repository.flow"
                    codeRepositoryRepository: "@repository_river.code_repository_repository"
                    authenticatorClient: "@security.authenticator.client.in_memory"
                    teamRepository: "@authenticator.team_repository"
                    eventBus: "@event_bus"
                    serializer: "@jms_serializer"
                    tracedUsageHistoryRepository: "@river.managed.resources.history_repository.traced"
                    commandBus: "@command_bus"
                - River\Task\BuildContext:
                    - "@builder.client"
                    - "@builder.client.traceable"
                    - "@builder.client.hookable"
                    - "@river.tide_event_store"
                    - "@event_bus"
                    - "@kernel"
                    - "@jms_serializer"
                    - "@tolerance.metrics.publisher.statsd"
                - River\Task\DeployContext:
                    - "@river.tide_event_store"
                    - "@event_bus"
                    - "@river.pipe_client"
                    - "@river.task.deploy.naming.environment_strategy"
                    - "@kernel"
                    - "@jms_serializer"
                    - "@river.flow.environment_client.callback"
                - River\Task\RunContext:
                    - "@kernel"
                    - "@river.pipe_client"
                    - "@jms_serializer"
                - River\Task\WaitContext: ~
                - River\Task\ManualApprovalContext:
                    - "@kernel"
                - River\TideSummaryContext:
                    - "@kernel"
                - River\AnalyticsContext:
                    - "@river.logitio.client.traceable"
                    - "@river.keen.client.traceable"
                - River\NotificationsContext:
                    - "@river.notifications.notifier.slack.traceable"
                - River\Task\WebHookContext:
                    - "@river.web_hooks.client.traceable"
                    - "@river.web_hooks.client.hookable"
                - River\ClusterHealthContext:
                    - "@river.k8s_health_checker.http.guzzle_client.stack"
                    - "@kernel"
                - River\FirebaseContext:
                    - "@csa_guzzle.data_collector.history_bag"
                - River\UserActivityContext:
                    - "@river.user_activity.traceable_dispatcher"
                    - "@river.user_activity.middleware_supporting_dispatcher"
                - River\QuayIoContext:
                    - "@csa_guzzle.data_collector.history_bag"

        builder:
            paths:
                - %paths.base%/features/builder/

            contexts:
                - Builder\BuilderContext:
                    - "@kernel"
                    - "@builder.docker.client.traceable"
                    - "@security.authenticator.client.in_memory"
                    - "@builder.archive_builder.traceable"
                    - "@builder.build.repository"
                    - "@builder.build_step.repository"
                    - "@builder.build.build_factory"
                    - "@jms_serializer"
                    - "@command_bus"
                    - "@builder.event_store"
                    - "@builder.request_transformer"
                    - "@tolerance.metrics.publisher.statsd"
                    - "@builder.google_container_builder.artifacts_manager.traceable"
                    - "@builder.google_container_builder.build_creator"
                    - "@builder.image.registry"
                    - "@builder.client"
                - Builder\DockerContext:
                    - "@builder.docker.client"
                    - "@log_stream.logger_factory"
                - Builder\DockerOutputContext:
                    - "@builder.docker.client.output_handler"
                - Builder\SecurityContext:
                    - "@security.authenticator.client.in_memory"
                    - "@security.token_storage"
                    - "@kernel"
                - Builder\Mock\DockerContext:
                    - "@builder.docker.client.callback"
                - Builder\HttpContext:
                    - "@builder.archive.http_archive_builder.http_client.handler.matching"
                    - "@csa_guzzle.data_collector.history_bag"
                - Builder\LoggingContext:
                    - "@log_stream.client.traceable"
                    - "@log_stream.client.in_memory"
                    - "@builder.reporting.publisher.traced"
                    - "@builder.time_resolver.predictable"
                - Builder\ArtifactContext:
                    - "@builder.artifact_manager.file_system"
                    - "@builder.artifact_remover.traced"

    gherkin:
        filters:
            tags: "~@integration && ~@elasticsearch && ~@elasticsearch_secure && ~@wip"

    extensions:
        Behat\Symfony2Extension:
            kernel:
                env: test

    gherkin:
        filters:
            tags: "~@wip && ~@onlySmoke && ~@integration && ~@elasticsearch && ~@elasticsearch_secure && ~@wip"

smoke:
    suites:
        river:
            contexts:
                - River\SecurityContext:
                    - "@security.token_storage"
                    - "@security.authenticator.client.in_memory"
                    - "@kernel"
                    - "@security.encryption.vault.previously_known"
                    - "@lexik_jwt_authentication.jwt_manager"
                    - "@jms_serializer"
                - River\FlowContext:
                    pipeClient: "@river.pipe_client.fake"
                    hookablePipeClient: "@river.hookable_pipe_client"
                    traceablePipeClient: "@river.pipe_client"
                    kernel: "@kernel"
                    flowRepository: "@river.repository.flow"
                    codeRepositoryRepository: "@repository_river.code_repository_repository"
                    authenticatorClient: "@security.authenticator.client.in_memory"
                    teamRepository: "@authenticator.team_repository"
                    eventBus: "@event_bus"
                    serializer: "@jms_serializer"
                    tracedUsageHistoryRepository: "@river.managed.resources.history_repository.traced"
                    commandBus: "@command_bus"
                - River\TideContext:
                    - "@command_bus"
                    - "@event_bus"
                    - "@river.tide_event_store"
                    - "@river.tide_factory"
                    - "@river.view.tide_repository"
                    - "@kernel"
                    - "@continuouspipe.message.default.message_producer.traced"
                    - "@river.time_resolver.predictable"
                    - "@river.repository.tide"
                    - "@continuouspipe.message.delayed.message_producer.delayed_messages_buffer"
                - River\GitHubContext:
                    - "@kernel"
                    - "@river.notifications.notifier.github.commit_status.traceable"
                    - "@river.pull_request_resolver"
                    - "@river.pipe_client"
                    - "@river.tide_event_store"
                    - "@river.github.http_client"
                    - "@github.integration.in_memory_installation_repository"
                    - "@github.integration.traceable_installation_repository"
                    - "@github.integration.installation_repository"
                    - "@github.integration.traceable_installation_token_resolver"
                    - "@github.integration.installation_token_resolver.in_memory"
                    - "@github.integration.installation_token_resolver"
                    - "@repository_river.code_repository_repository"
                    - "@river.github.guzzle_http_client.handler.matching"
                    - "@river.code_repository.branch_query.in_memory"
                - River\CodeRepositoriesContext:
                    - "@river.commit_resolver.predictable"
                    - "@event_bus"
                    - "@river.tide_event_store"
                    - "@river.code_repository.branch_query.in_memory"
                    - "@river.code_repository.local_filesystem_resolver"
                    - "@river.code_repository.code_archive_streamer.overwritten"
                    - "@river.code_repository.partially_overwritten_filesystem_resolver"
                - River\TideConfigurationContext:
                    - "@river.tide_configuration_factory"
                - River\Tide\TasksContext:
                    - "@event_bus"
                    - "@river.repository.tide"
                - River\Task\BuildContext:
                    - "@builder.client"
                    - "@builder.client.traceable"
                    - "@builder.client.hookable"
                    - "@river.tide_event_store"
                    - "@event_bus"
                    - "@kernel"
                    - "@jms_serializer"
                    - "@tolerance.metrics.publisher.statsd"
                - River\NotificationsContext:
                    - "@river.notifications.notifier.slack.traceable"
                - River\DevelopmentEnvironmentContext:
                    - "@kernel"
                    - "@event_bus"

    extensions:
        Behat\Symfony2Extension:
            kernel:
                env: smoke_test

    gherkin:
        filters:
            tags: "@smoke && ~@wip"
