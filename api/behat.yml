default:
    suites:
        domain:
            paths:
                - %paths.base%/features/domain/

            contexts:
                - SecurityContext:
                    - @security.token_storage
                    - @security.authenticator.client
                - TideConfigurationContext:
                    - @river.tide_configuration_factory
                - TideContext:
                    - @command_bus
                    - @event_bus
                    - @river.tide_event_store
                    - @river.file_system_resolver.fake
                    - @river.tide_factory
                    - @river.view.tide_repository
                    - @kernel
                    - @river.queue.delayed_command_bus.traced
                    - @river.time_resolver.predictable
                    - @river.repository.tide
                - Tide\TasksContext:
                    - @event_bus
                    - @river.repository.tide
                - LoggingContext:
                    - @log_stream.client
                - CodeRepositoriesContext:
                    - @river.commit_resolver.predictable
                    - @event_bus
                    - @river.tide_event_store
                - FlowContext:
                    - @kernel
                    - @river.repository.flow
                    - @repository_river.code_repository_repository
                    - @security.authenticator.client
                    - @river.pipe_client.fake
                    - @river.pipe_client
                    - @authenticator.team_repository
                    - @event_bus
                - Task\BuildContext:
                    - @river.tide_event_store
                    - @event_bus
                    - @kernel
                    - @jms_serializer
                - Task\DeployContext:
                    - @river.tide_event_store
                    - @event_bus
                    - @river.pipe_client
                    - @river.task.deploy.naming.environment_strategy
                    - @kernel
                    - @jms_serializer
                - Task\RunContext:
                    - @kernel
                    - @river.pipe_client
                    - @jms_serializer
                - Task\WaitContext: ~
                - Task\ManualApprovalContext:
                    - @kernel
                - TideSummaryContext:
                    - @kernel
                - AnalyticsContext:
                    - @river.keen.client.traceable
                - NotificationsContext:
                    - @river.notifications.notifier.slack.traceable
                - Task\WebHookContext:
                    - @river.web_hooks.client.traceable
                    - @river.web_hooks.client.hookable
                - ClusterHealthContext:
                    - @river.k8s_health_checker.http.guzzle_client.stack
                    - @kernel
                - FirebaseContext:
                    - @csa_guzzle.data_collector.history_bag

                # TBR:
                - GitHubContext:
                    - @kernel
                    - @river.notifications.notifier.github.commit_status.traceable
                    - @river.github.pull_request_resolver
                    - @river.pipe_client
                    - @river.tide_event_store
                    - @river.github.http_client
                    - @github.integration.in_memory_installation_repository
                    - @github.integration.installation_token_resolver.in_memory
                    - @repository_river.code_repository_repository

        github:
            paths:
                - %paths.base%/features/integrations/code-repositories/common/
                - %paths.base%/features/integrations/code-repositories/github/

            contexts:
                # GitHub-specific contexts
                - GitHubContext:
                    - @kernel
                    - @river.notifications.notifier.github.commit_status.traceable
                    - @river.github.pull_request_resolver
                    - @river.pipe_client
                    - @river.tide_event_store
                    - @river.github.http_client
                    - @github.integration.in_memory_installation_repository
                    - @github.integration.installation_token_resolver.in_memory
                    - @repository_river.code_repository_repository

                # Common contexts
                - SecurityContext:
                    - @security.token_storage
                    - @security.authenticator.client
                - TideConfigurationContext:
                    - @river.tide_configuration_factory
                - TideContext:
                    - @command_bus
                    - @event_bus
                    - @river.tide_event_store
                    - @river.file_system_resolver.fake
                    - @river.tide_factory
                    - @river.view.tide_repository
                    - @kernel
                    - @river.queue.delayed_command_bus.traced
                    - @river.time_resolver.predictable
                    - @river.repository.tide
                - Tide\TasksContext:
                    - @event_bus
                    - @river.repository.tide
                - LoggingContext:
                    - @log_stream.client
                - CodeRepositoriesContext:
                    - @river.commit_resolver.predictable
                    - @event_bus
                    - @river.tide_event_store
                - FlowContext:
                    - @kernel
                    - @river.repository.flow
                    - @repository_river.code_repository_repository
                    - @security.authenticator.client
                    - @river.pipe_client.fake
                    - @river.pipe_client
                    - @authenticator.team_repository
                    - @event_bus
                - Task\BuildContext:
                    - @river.tide_event_store
                    - @event_bus
                    - @kernel
                    - @jms_serializer
                - Task\DeployContext:
                    - @river.tide_event_store
                    - @event_bus
                    - @river.pipe_client
                    - @river.task.deploy.naming.environment_strategy
                    - @kernel
                    - @jms_serializer
                - Task\RunContext:
                    - @kernel
                    - @river.pipe_client
                    - @jms_serializer
                - Task\WaitContext: ~
                - Task\ManualApprovalContext:
                    - @kernel
                - TideSummaryContext:
                    - @kernel
                - AnalyticsContext:
                    - @river.keen.client.traceable
                - NotificationsContext:
                    - @river.notifications.notifier.slack.traceable
                - Task\WebHookContext:
                    - @river.web_hooks.client.traceable
                    - @river.web_hooks.client.hookable
                - ClusterHealthContext:
                    - @river.k8s_health_checker.http.guzzle_client.stack
                    - @kernel
                - FirebaseContext:
                    - @csa_guzzle.data_collector.history_bag

        bitbucket:
            paths:
                - %paths.base%/features/integrations/code-repositories/common/
                - %paths.base%/features/integrations/code-repositories/bitbucket/

            contexts:
                # BitBucket-specific contexts
                - BitBucketContext:
                    - @river.code_repository.bitbucket.explorer.http_client.handler.matching
                    - @kernel
                    - @atlassian_addon.installation_repository.traceable
                    - @jms_serializer
                    - @river.bitbucket.client_factory
                    - @csa_guzzle.data_collector.history_bag
                    - @repository_river.code_repository_repository

                # Common contexts
                - SecurityContext:
                    - @security.token_storage
                    - @security.authenticator.client
                - TideConfigurationContext:
                    - @river.tide_configuration_factory
                - TideContext:
                    - @command_bus
                    - @event_bus
                    - @river.tide_event_store
                    - @river.file_system_resolver.fake
                    - @river.tide_factory
                    - @river.view.tide_repository
                    - @kernel
                    - @river.queue.delayed_command_bus.traced
                    - @river.time_resolver.predictable
                    - @river.repository.tide
                - Tide\TasksContext:
                    - @event_bus
                    - @river.repository.tide
                - LoggingContext:
                    - @log_stream.client
                - CodeRepositoriesContext:
                    - @river.commit_resolver.predictable
                    - @event_bus
                    - @river.tide_event_store
                - FlowContext:
                    - @kernel
                    - @river.repository.flow
                    - @repository_river.code_repository_repository
                    - @security.authenticator.client
                    - @river.pipe_client.fake
                    - @river.pipe_client
                    - @authenticator.team_repository
                    - @event_bus
                - Task\BuildContext:
                    - @river.tide_event_store
                    - @event_bus
                    - @kernel
                    - @jms_serializer
                - Task\DeployContext:
                    - @river.tide_event_store
                    - @event_bus
                    - @river.pipe_client
                    - @river.task.deploy.naming.environment_strategy
                    - @kernel
                    - @jms_serializer
                - Task\RunContext:
                    - @kernel
                    - @river.pipe_client
                    - @jms_serializer
                - Task\WaitContext: ~
                - Task\ManualApprovalContext:
                    - @kernel
                - TideSummaryContext:
                    - @kernel
                - AnalyticsContext:
                    - @river.keen.client.traceable
                - NotificationsContext:
                    - @river.notifications.notifier.slack.traceable
                - Task\WebHookContext:
                    - @river.web_hooks.client.traceable
                    - @river.web_hooks.client.hookable
                - ClusterHealthContext:
                    - @river.k8s_health_checker.http.guzzle_client.stack
                    - @kernel
                - FirebaseContext:
                    - @csa_guzzle.data_collector.history_bag

    extensions:
        Behat\Symfony2Extension:
            kernel:
                env: test

    gherkin:
        filters:
            tags: "~@wip"

smoke:
    suites:
        application:
            contexts:
                - SecurityContext:
                    - @security.token_storage
                    - @security.authenticator.client
                - FlowContext:
                    - @kernel
                    - @river.repository.flow
                    - @repository_river.code_repository_repository
                    - @security.authenticator.client
                    - @river.pipe_client.fake
                    - @river.pipe_client
                    - @authenticator.team_repository
                    - @event_bus
                - TideContext:
                    - @command_bus
                    - @event_bus
                    - @river.tide_event_store
                    - @river.file_system_resolver.fake
                    - @river.tide_factory
                    - @river.view.tide_repository
                    - @kernel
                    - @river.queue.delayed_command_bus.traced
                    - @river.time_resolver.predictable
                    - @river.repository.tide
                - GitHubContext:
                    - @kernel
                    - @river.notifications.notifier.github.commit_status.traceable
                    - @river.github.pull_request_resolver
                    - @river.pipe_client
                    - @river.tide_event_store
                    - @river.github.http_client
                    - @github.integration.in_memory_installation_repository
                    - @github.integration.installation_token_resolver.in_memory
                    - @repository_river.code_repository_repository
                - CodeRepositoriesContext:
                    - @river.commit_resolver.predictable
                    - @event_bus
                    - @river.tide_event_store
                - TideConfigurationContext:
                    - @river.tide_configuration_factory
                - Tide\TasksContext:
                    - @event_bus
                    - @river.repository.tide
                - Task\BuildContext:
                    - @river.tide_event_store
                    - @event_bus
                    - @kernel
                    - @jms_serializer
                - NotificationsContext:
                    - @river.notifications.notifier.slack.traceable

    extensions:
        Behat\Symfony2Extension:
            kernel:
                env: smoke_test

    gherkin:
        filters:
            tags: "@smoke && ~@wip"
