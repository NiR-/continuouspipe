domain:
    suites:
        river_domain:
            paths:
                - %paths.base%/features/river/domain/

            contexts:
                - River\SecurityContext:
                    - "@security.token_storage"
                    - "@kernel"
                    - "@security.vaults.user_secrets.previously_known"
                    - "@lexik_jwt_authentication.jwt_manager"
                    - "@jms_serializer"
                    - "@app.security.api_key.user_by_api_key_repository"
                    - "@app.repository.user"
                    - "@app.repository.team"
                    - "@app.repository.credentials_bucket"
                    - "@security.team_usage_limits"
                    - "@app.repository.account"
                    - "@app.repository.team_membership"
                    - "@security.user_api_key.uuid_generator"
                - River\TideConfigurationContext:
                    - "@river.tide_configuration_factory"
                - River\TideContext:
                    - "@command_bus"
                    - "@event_bus"
                    - "@river.tide_event_store"
                    - "@river.tide_factory"
                    - "@river.view.tide_repository"
                    - "@kernel"
                    - "@continuouspipe.message.default.message_producer.traced"
                    - "@river.time_resolver.predictable"
                    - "@river.repository.tide"
                    - "@continuouspipe.message.delay.delayed_messages_buffer"
                - River\Tide\TasksContext:
                    - "@event_bus"
                    - "@river.repository.tide"
                - River\LoggingContext:
                    - "@kernel"
                    - "@log_stream.client.in_memory"
                    - "@logger"
                - River\CodeRepositoriesContext:
                    - "@river.commit_resolver.predictable"
                    - "@event_bus"
                    - "@river.tide_event_store"
                    - "@river.code_repository.branch_query.in_memory"
                    - "@river.code_repository.local_filesystem_resolver"
                    - "@river.code_repository.code_archive_streamer.overwritten"
                    - "@river.code_repository.partially_overwritten_filesystem_resolver"
                - River\FlowContext:
                    pipeClient: "@river.pipe_client.fake"
                    hookablePipeClient: "@river.hookable_pipe_client"
                    traceablePipeClient: "@river.pipe_client"
                    kernel: "@kernel"
                    flowRepository: "@river.repository.flow"
                    codeRepositoryRepository: "@repository_river.code_repository_repository"
                    userRepository: "@app.repository.user"
                    teamRepository: "@app.repository.team"
                    eventBus: "@event_bus"
                    serializer: "@jms_serializer"
                    tracedUsageHistoryRepository: "@river.managed.resources.history_repository.traced"
                    commandBus: "@command_bus"
                - River\Task\BuildContext:
                    - "@builder.client"
                    - "@builder.client.traceable"
                    - "@builder.client.hookable"
                    - "@river.tide_event_store"
                    - "@event_bus"
                    - "@kernel"
                    - "@jms_serializer"
                    - "@tolerance.metrics.publisher.statsd"
                - River\Task\DeployContext:
                    - "@river.tide_event_store"
                    - "@event_bus"
                    - "@river.pipe_client"
                    - "@river.task.deploy.naming.environment_strategy"
                    - "@kernel"
                    - "@jms_serializer"
                    - "@river.flow.environment_client.callback"
                - River\Task\RunContext:
                    - "@kernel"
                    - "@river.pipe_client"
                    - "@jms_serializer"
                - River\Task\WaitContext: ~
                - River\Task\ManualApprovalContext:
                    - "@kernel"
                - River\TeamContext:
                    - "@kernel"
                    - "@app.repository.team"
                - River\TideSummaryContext:
                    - "@kernel"
                - River\AnalyticsContext:
                    - "@river.keen.client.traceable"
                    - "@river.logitio.client.traceable"
                - River\NotificationsContext:
                    - "@river.notifications.notifier.slack.traceable"
                - River\Task\WebHookContext:
                    - "@river.web_hooks.client.traceable"
                    - "@river.web_hooks.client.hookable"
                - River\ClusterHealthContext:
                    - "@river.k8s_health_checker.http.guzzle_client.stack"
                    - "@kernel"
                - River\FirebaseContext:
                    - "@csa_guzzle.data_collector.history_bag"
                    - "%%env(FIREBASE_APP)%%"
                - River\DevelopmentEnvironmentContext:
                    - "@kernel"
                    - "@event_bus"
                - River\BranchContext:
                    - "@command_bus"
                - River\QuayIoContext:
                    - "@csa_guzzle.data_collector.history_bag"

                # TBR:
                - River\GitHubContext:
                    - "@kernel"
                    - "@river.notifications.notifier.github.commit_status.traceable"
                    - "@river.pull_request_resolver"
                    - "@river.pipe_client"
                    - "@river.tide_event_store"
                    - "@river.github.http_client"
                    - "@github.integration.in_memory_installation_repository"
                    - "@github.integration.traceable_installation_repository"
                    - "@github.integration.installation_repository"
                    - "@github.integration.traceable_installation_token_resolver"
                    - "@github.integration.installation_token_resolver.in_memory"
                    - "@github.integration.installation_token_resolver"
                    - "@repository_river.code_repository_repository"
                    - "@river.github.guzzle_http_client.handler.matching"
                    - "@river.code_repository.branch_query.in_memory"

                - River\StorageContext:
                    - "@river.pipeline.view.storage"
                    - "@river.repository.flow"
                    - "@kernel"

        river_github:
            paths:
                - %paths.base%/features/river/integrations/code-repositories/common/
                - %paths.base%/features/river/integrations/code-repositories/github/

            contexts:
                - River\CacheContext:
                    - "@river.cache"

                # GitHub-specific contexts
                - River\GitHubContext:
                    - "@kernel"
                    - "@river.notifications.notifier.github.commit_status.traceable"
                    - "@river.pull_request_resolver"
                    - "@river.pipe_client"
                    - "@river.tide_event_store"
                    - "@river.github.http_client"
                    - "@github.integration.in_memory_installation_repository"
                    - "@github.integration.traceable_installation_repository"
                    - "@github.integration.installation_repository"
                    - "@github.integration.traceable_installation_token_resolver"
                    - "@github.integration.installation_token_resolver.in_memory"
                    - "@github.integration.installation_token_resolver"
                    - "@repository_river.code_repository_repository"
                    - "@river.github.guzzle_http_client.handler.matching"
                    - "@river.code_repository.branch_query.in_memory"

                # Common contexts
                - River\SecurityContext:
                    - "@security.token_storage"
                    - "@kernel"
                    - "@security.vaults.user_secrets.previously_known"
                    - "@lexik_jwt_authentication.jwt_manager"
                    - "@jms_serializer"
                    - "@app.security.api_key.user_by_api_key_repository"
                    - "@app.repository.user"
                    - "@app.repository.team"
                    - "@app.repository.credentials_bucket"
                    - "@security.team_usage_limits"
                    - "@app.repository.account"
                    - "@app.repository.team_membership"
                    - "@security.user_api_key.uuid_generator"
                - River\TideConfigurationContext:
                    - "@river.tide_configuration_factory"
                - River\TideContext:
                    - "@command_bus"
                    - "@event_bus"
                    - "@river.tide_event_store"
                    - "@river.tide_factory"
                    - "@river.view.tide_repository"
                    - "@kernel"
                    - "@continuouspipe.message.default.message_producer.traced"
                    - "@river.time_resolver.predictable"
                    - "@river.repository.tide"
                    - "@continuouspipe.message.delay.delayed_messages_buffer"
                - River\Tide\TasksContext:
                    - "@event_bus"
                    - "@river.repository.tide"
                - River\LoggingContext:
                    - "@kernel"
                    - "@log_stream.client.in_memory"
                    - "@logger"
                - River\CodeRepositoriesContext:
                    - "@river.commit_resolver.predictable"
                    - "@event_bus"
                    - "@river.tide_event_store"
                    - "@river.code_repository.branch_query.in_memory"
                    - "@river.code_repository.local_filesystem_resolver"
                    - "@river.code_repository.code_archive_streamer.overwritten"
                    - "@river.code_repository.partially_overwritten_filesystem_resolver"
                - River\FlowContext:
                    pipeClient: "@river.pipe_client.fake"
                    hookablePipeClient: "@river.hookable_pipe_client"
                    traceablePipeClient: "@river.pipe_client"
                    kernel: "@kernel"
                    flowRepository: "@river.repository.flow"
                    codeRepositoryRepository: "@repository_river.code_repository_repository"
                    userRepository: "@app.repository.user"
                    teamRepository: "@app.repository.team"
                    eventBus: "@event_bus"
                    serializer: "@jms_serializer"
                    tracedUsageHistoryRepository: "@river.managed.resources.history_repository.traced"
                    commandBus: "@command_bus"
                - River\Task\BuildContext:
                    - "@builder.client"
                    - "@builder.client.traceable"
                    - "@builder.client.hookable"
                    - "@river.tide_event_store"
                    - "@event_bus"
                    - "@kernel"
                    - "@jms_serializer"
                    - "@tolerance.metrics.publisher.statsd"
                - River\Task\DeployContext:
                    - "@river.tide_event_store"
                    - "@event_bus"
                    - "@river.pipe_client"
                    - "@river.task.deploy.naming.environment_strategy"
                    - "@kernel"
                    - "@jms_serializer"
                    - "@river.flow.environment_client.callback"
                - River\Task\RunContext:
                    - "@kernel"
                    - "@river.pipe_client"
                    - "@jms_serializer"
                - River\Task\WaitContext: ~
                - River\Task\ManualApprovalContext:
                    - "@kernel"
                - River\TideSummaryContext:
                    - "@kernel"
                - River\AnalyticsContext:
                    - "@river.logitio.client.traceable"
                    - "@river.keen.client.traceable"
                - River\NotificationsContext:
                    - "@river.notifications.notifier.slack.traceable"
                - River\Task\WebHookContext:
                    - "@river.web_hooks.client.traceable"
                    - "@river.web_hooks.client.hookable"
                - River\ClusterHealthContext:
                    - "@river.k8s_health_checker.http.guzzle_client.stack"
                    - "@kernel"
                - River\FirebaseContext:
                    - "@csa_guzzle.data_collector.history_bag"
                    - "%%env(FIREBASE_APP)%%"
                - River\QuayIoContext:
                    - "@csa_guzzle.data_collector.history_bag"

        river_bitbucket:
            paths:
                - %paths.base%/features/river/integrations/code-repositories/common/
                - %paths.base%/features/river/integrations/code-repositories/bitbucket/

            contexts:
                # BitBucket-specific contexts
                - River\BitBucketContext:
                    - "@river.code_repository.bitbucket.explorer.http_client.handler.matching"
                    - "@kernel"
                    - "@atlassian_addon.installation_repository.traceable"
                    - "@jms_serializer"
                    - "@river.bitbucket.client_factory"
                    - "@csa_guzzle.data_collector.history_bag"
                    - "@repository_river.code_repository_repository"
                    - "@river.code_repository.branch_query.in_memory"
                    - "@river.pull_request_resolver"

                - River\BitBucket\AddonContext:
                    - "@kernel"
                    - "@atlassian_addon.installation_repository.traceable"
                    - "@jms_serializer"

                # Common contexts
                - River\SecurityContext:
                    - "@security.token_storage"
                    - "@kernel"
                    - "@security.vaults.user_secrets.previously_known"
                    - "@lexik_jwt_authentication.jwt_manager"
                    - "@jms_serializer"
                    - "@app.security.api_key.user_by_api_key_repository"
                    - "@app.repository.user"
                    - "@app.repository.team"
                    - "@app.repository.credentials_bucket"
                    - "@security.team_usage_limits"
                    - "@app.repository.account"
                    - "@app.repository.team_membership"
                    - "@security.user_api_key.uuid_generator"
                - River\TideConfigurationContext:
                    - "@river.tide_configuration_factory"
                - River\TideContext:
                    - "@command_bus"
                    - "@event_bus"
                    - "@river.tide_event_store"
                    - "@river.tide_factory"
                    - "@river.view.tide_repository"
                    - "@kernel"
                    - "@continuouspipe.message.default.message_producer.traced"
                    - "@river.time_resolver.predictable"
                    - "@river.repository.tide"
                    - "@continuouspipe.message.delay.delayed_messages_buffer"
                - River\Tide\TasksContext:
                    - "@event_bus"
                    - "@river.repository.tide"
                - River\LoggingContext:
                    - "@kernel"
                    - "@log_stream.client.in_memory"
                    - "@logger"
                - River\CodeRepositoriesContext:
                    - "@river.commit_resolver.predictable"
                    - "@event_bus"
                    - "@river.tide_event_store"
                    - "@river.code_repository.branch_query.in_memory"
                    - "@river.code_repository.local_filesystem_resolver"
                    - "@river.code_repository.code_archive_streamer.overwritten"
                    - "@river.code_repository.partially_overwritten_filesystem_resolver"
                - River\FlowContext:
                    pipeClient: "@river.pipe_client.fake"
                    hookablePipeClient: "@river.hookable_pipe_client"
                    traceablePipeClient: "@river.pipe_client"
                    kernel: "@kernel"
                    flowRepository: "@river.repository.flow"
                    codeRepositoryRepository: "@repository_river.code_repository_repository"
                    userRepository: "@app.repository.user"
                    teamRepository: "@app.repository.team"
                    eventBus: "@event_bus"
                    serializer: "@jms_serializer"
                    tracedUsageHistoryRepository: "@river.managed.resources.history_repository.traced"
                    commandBus: "@command_bus"
                - River\Task\BuildContext:
                    - "@builder.client"
                    - "@builder.client.traceable"
                    - "@builder.client.hookable"
                    - "@river.tide_event_store"
                    - "@event_bus"
                    - "@kernel"
                    - "@jms_serializer"
                    - "@tolerance.metrics.publisher.statsd"
                - River\Task\DeployContext:
                    - "@river.tide_event_store"
                    - "@event_bus"
                    - "@river.pipe_client"
                    - "@river.task.deploy.naming.environment_strategy"
                    - "@kernel"
                    - "@jms_serializer"
                    - "@river.flow.environment_client.callback"
                - River\Task\RunContext:
                    - "@kernel"
                    - "@river.pipe_client"
                    - "@jms_serializer"
                - River\Task\WaitContext: ~
                - River\Task\ManualApprovalContext:
                    - "@kernel"
                - River\TideSummaryContext:
                    - "@kernel"
                - River\AnalyticsContext:
                    - "@river.logitio.client.traceable"
                    - "@river.keen.client.traceable"
                - River\NotificationsContext:
                    - "@river.notifications.notifier.slack.traceable"
                - River\Task\WebHookContext:
                    - "@river.web_hooks.client.traceable"
                    - "@river.web_hooks.client.hookable"
                - River\ClusterHealthContext:
                    - "@river.k8s_health_checker.http.guzzle_client.stack"
                    - "@kernel"
                - River\FirebaseContext:
                    - "@csa_guzzle.data_collector.history_bag"
                    - "%%env(FIREBASE_APP)%%"
                - River\QuayIoContext:
                    - "@csa_guzzle.data_collector.history_bag"

        builder:
            paths:
                - %paths.base%/features/builder/

            contexts:
                - Builder\BuilderContext:
                    - "@kernel"
                    - "@builder.docker.client.traceable"
                    - "@builder.archive_builder.traceable"
                    - "@builder.build.repository"
                    - "@builder.build_step.repository"
                    - "@builder.build.build_factory"
                    - "@jms_serializer"
                    - "@command_bus"
                    - "@builder.event_store"
                    - "@builder.request_transformer"
                    - "@tolerance.metrics.publisher.statsd"
                    - "@builder.google_container_builder.artifacts_manager.traceable"
                    - "@builder.google_container_builder.build_creator"
                    - "@builder.image.registry"
                    - "@builder.client"
                - Builder\DockerContext:
                    - "@builder.docker.client"
                    - "@log_stream.logger_factory"
                - Builder\DockerOutputContext:
                    - "@builder.docker.client.output_handler"
                - Builder\SecurityContext:
                    - "@app.repository.credentials_bucket"
                    - "@security.token_storage"
                    - "@kernel"
                - Builder\Mock\DockerContext:
                    - "@builder.docker.client.callback"
                - Builder\HttpContext:
                    - "@builder.archive.http_archive_builder.http_client.handler.matching"
                    - "@csa_guzzle.data_collector.history_bag"
                - Builder\LoggingContext:
                    - "@log_stream.client.traceable"
                    - "@log_stream.client.in_memory"
                    - "@builder.reporting.publisher.traced"
                    - "@builder.time_resolver.predictable"
                - Builder\ArtifactContext:
                    - "@builder.artifact_manager.file_system"
                    - "@builder.artifact_remover.traced"

        pipe:
            paths:
                - %paths.base%/features/pipe/

            contexts:
                - Pipe\ApiContext:
                    - "@security.token_storage"
                    - "@app.repository.user"
                    - "@kernel"
                - Pipe\DeploymentContext:
                    - "@pipe.view.deployment_repository"
                    - "@pipe.event_store"
                    - "@event_bus"
                    - "@jms_serializer"
                    - "@pipe.client"
                - Pipe\EnvironmentContext:
                    - "@pipe.event_store"
                    - "@pipe.view.deployment_repository"
                    - "@event_bus"
                    - "@pipe.adapter.kubernetes.hookable.namespace_repository"
                    - "@lexik_jwt_authentication.jwt_manager"
                    - "@pipe.client"
                    - "@jms_serializer"
                    - "@app.repository.team"
                - Pipe\NotificationContext:
                    - "@pipe.notification.notifier.traceable"
                    - "@pipe.notification.notifier.hookable"
                - Pipe\SecurityContext:
                    - "@app.repository.credentials_bucket"
                    - "@jms_serializer"
                    - "@app.repository.team"
                    - "@security.vaults.within_clusters.previously_known"
                    - "@pipe.adapter.kubernetes.traceable.role_binding_repository"
                    - "@pipe.adapter.kubernetes.in_memory.role_binding_repository"
                    - "@pipe.adapter.kubernetes.traceable.network_policy_repository"
                    - "@pipe.adapter.kubernetes.in_memory.network_policy_repository"
                - Pipe\Kubernetes\NamespaceContext:
                    - "@pipe.adapter.kubernetes.traceable.namespace_repository"
                    - "@event_bus"
                    - "@pipe.adapter.kubernetes.traceable.secret_repository"
                    - "@pipe.adapter.kubernetes.traceable.service_account_repository"
                    - "@log_stream.logger_factory"
                    - "@pipe.adapter.kubernetes.in_memory.service_account_repository"
                    - "@pipe.adapter.kubernetes.in_memory.secret_repository"
                    - "@pipe.adapter.kubernetes.hookable.service_account_repository"
                    - "@pipe.adapter.kubernetes.hookable.namespace_repository"
                - Pipe\Kubernetes\ReplicationControllerContext:
                    - "@pipe.adapter.kubernetes.traceable.replication_controller_repository"
                    - "@pipe.adapter.kubernetes.in_memory.pod_repository"
                    - "@pipe.adapter.kubernetes.traceable.pod_repository"
                - Pipe\Kubernetes\PodContext:
                    - "@pipe.adapter.kubernetes.traceable.pod_repository"
                    - "@pipe.adapter.kubernetes.in_memory.pod_repository"
                    - "@pipe.adapter.kubernetes.hookable.pod_repository"
                    - "@pipe.adapter.kubernetes.in_memory.event_repository"
                - Pipe\Kubernetes\ServiceContext:
                    - "@pipe.adapter.kubernetes.hookable.service_repository"
                    - "@pipe.adapter.kubernetes.traceable.service_repository"
                - Pipe\Kubernetes\IngressContext:
                    - "@pipe.adapter.kubernetes.traceable.ingress_repository"
                    - "@pipe.adapter.kubernetes.hookable.ingress_repository"
                    - "@pipe.adapter.kubernetes.in_memory.ingress_repository"
                - Pipe\Kubernetes\VolumeContext:
                    - "@pipe.adapter.kubernetes.traceable.persistent_volume_claim_repository"
                    - "@pipe.adapter.kubernetes.traceable.replication_controller_repository"
                    - "@pipe.adapter.kubernetes.traceable.pod_repository"
                - Pipe\Kubernetes\Mock\ReplicationControllerContext:
                    - "@pipe.adapter.kubernetes.hookable.replication_controller_repository"
                    - "@pipe.adapter.kubernetes.hookable.pod_repository"
                - Pipe\Kubernetes\DeploymentContext:
                    - "@pipe.adapter.kubernetes.traceable.deployment_repository"
                    - "@pipe.adapter.kubernetes.in_memory.deployment_repository"
                - Pipe\Kubernetes\Mock\DeploymentContext:
                    - "@pipe.adapter.kubernetes.hookable.deployment_repository"
                    - "@pipe.adapter.kubernetes.hookable.pod_repository"
                    - "@pipe.adapter.kubernetes.in_memory.deployment_repository"
                    - "@pipe.adapter.kubernetes.in_memory.pod_repository"
                - Pipe\CloudFlareContext:
                    - "@pipe.cloud_flare.client.traceable"
                    - "@pipe.cloud_flare.client.api"
                - Pipe\HttpLabsContext:
                    - "@pipe.httplabs.http_client.handler.matching"
                    - "@pipe.httplabs.client.traceable"
                - Pipe\ClusterHealthContext:
                    - "@pipe.k8s_health_checker.http.guzzle_client.stack"
                    - "@kernel"
                    - "@log_stream.client.in_memory"
                - Pipe\LogContext:
                    - "@logger"
                    - "@log_stream.hookable_factory"

        authenticator:
            paths:
                - %paths.base%/features/authenticator/

            contexts:
                - Authenticator\SecurityContext:
                    - "@app.security.user_provider"
                    - "@security.token_storage"
                    - "@app.repository.security_user"
                    - "@app.security.api_key.system_user_by_api_key"
                    - "@event_dispatcher"
                    - "@hwi_oauth.resource_owner.github"
                    - "@kernel"
                    - "@app.security.api_key.user_by_api_key_repository"
                    - "@session"
                    - "@test.http_client"
                    - "@app.repository.team"
                - Authenticator\UserContext:
                    - "@app.repository.security_user"
                    - "@app.repository.credentials_bucket"
                    - "@kernel"
                    - "@app.security.api_key.system_user_by_api_key"
                - Authenticator\CredentialsBucketContext:
                    - "@kernel"
                    - "@app.repository.credentials_bucket"
                - Authenticator\TeamContext:
                    - "@kernel"
                    - "@app.repository.team"
                    - "@app.repository.team_membership"
                    - "@app.repository.credentials_bucket"
                    - "@kube_status.http.middleware.predictable_request_mapping"
                - Authenticator\InvitationContext:
                    - "@kernel"
                    - "@app.repository.user_invitation"
                - Authenticator\IntercomContext:
                    - "@app.intercom.traceable_client"
                    - "@app.intercom.hookable_client"
                - Authenticator\AccountsContext:
                    - "@app.repository.account"
                    - "@kernel"
                    - "@google.http.middleware.predictable_request_mapping"
                    - "@app.repository.billing_profile"
                    - "@app.billing.plan_repository"
                - Authenticator\LoggingContext:
                    - "@kernel"
                    - "@logger"
                - Authenticator\SubscriptionContext:
                    - "@kernel"
                - Authenticator\AuditLogContext:
                    - "@authenticator.audit_log.storage.traced_log_repository"
                    - "@test.http_client"
                - Common\FeatureFlag:
                    - "@platform.flag_resolver"

    extensions:
        Behat\Symfony2Extension:
            kernel:
                env: test

    gherkin:
        filters:
            tags: "~@wip && ~@onlySmoke && ~@integration && ~@elasticsearch && ~@elasticsearch_secure && ~@wip"

smoke:
    suites:
        river:
            paths:
                - %paths.base%/features/river

            contexts:
                - River\SecurityContext:
                    - "@security.token_storage"
                    - "@kernel"
                    - "@security.vaults.user_secrets.previously_known"
                    - "@lexik_jwt_authentication.jwt_manager"
                    - "@jms_serializer"
                    - "@app.security.api_key.user_by_api_key_repository"
                    - "@app.repository.user"
                    - "@app.repository.team"
                    - "@app.repository.credentials_bucket"
                    - "@security.team_usage_limits"
                    - "@app.repository.account"
                    - "@app.repository.team_membership"
                    - "@security.user_api_key.uuid_generator"
                - River\FlowContext:
                    pipeClient: "@river.pipe_client.fake"
                    hookablePipeClient: "@river.hookable_pipe_client"
                    traceablePipeClient: "@river.pipe_client"
                    kernel: "@kernel"
                    flowRepository: "@river.repository.flow"
                    codeRepositoryRepository: "@repository_river.code_repository_repository"
                    userRepository: "@app.repository.user"
                    teamRepository: "@app.repository.team"
                    eventBus: "@event_bus"
                    serializer: "@jms_serializer"
                    tracedUsageHistoryRepository: "@river.managed.resources.history_repository.traced"
                    commandBus: "@command_bus"
                - River\TideContext:
                    - "@command_bus"
                    - "@event_bus"
                    - "@river.tide_event_store"
                    - "@river.tide_factory"
                    - "@river.view.tide_repository"
                    - "@kernel"
                    - "@continuouspipe.message.default.message_producer.traced"
                    - "@river.time_resolver.predictable"
                    - "@river.repository.tide"
                    - "@continuouspipe.message.delay.delayed_messages_buffer"
                - River\GitHubContext:
                    - "@kernel"
                    - "@river.notifications.notifier.github.commit_status.traceable"
                    - "@river.pull_request_resolver"
                    - "@river.pipe_client"
                    - "@river.tide_event_store"
                    - "@river.github.http_client"
                    - "@github.integration.in_memory_installation_repository"
                    - "@github.integration.traceable_installation_repository"
                    - "@github.integration.installation_repository"
                    - "@github.integration.traceable_installation_token_resolver"
                    - "@github.integration.installation_token_resolver.in_memory"
                    - "@github.integration.installation_token_resolver"
                    - "@repository_river.code_repository_repository"
                    - "@river.github.guzzle_http_client.handler.matching"
                    - "@river.code_repository.branch_query.in_memory"
                - River\BitBucket\AddonContext:
                    - "@kernel"
                    - "@atlassian_addon.installation_repository.traceable"
                    - "@jms_serializer"
                - River\CodeRepositoriesContext:
                    - "@river.commit_resolver.predictable"
                    - "@event_bus"
                    - "@river.tide_event_store"
                    - "@river.code_repository.branch_query.in_memory"
                    - "@river.code_repository.local_filesystem_resolver"
                    - "@river.code_repository.code_archive_streamer.overwritten"
                    - "@river.code_repository.partially_overwritten_filesystem_resolver"
                - River\TideConfigurationContext:
                    - "@river.tide_configuration_factory"
                - River\Tide\TasksContext:
                    - "@event_bus"
                    - "@river.repository.tide"
                - River\Task\BuildContext:
                    - "@builder.client"
                    - "@builder.client.traceable"
                    - "@builder.client.hookable"
                    - "@river.tide_event_store"
                    - "@event_bus"
                    - "@kernel"
                    - "@jms_serializer"
                    - "@tolerance.metrics.publisher.statsd"
                - River\Task\DeployContext:
                    - "@river.tide_event_store"
                    - "@event_bus"
                    - "@river.pipe_client"
                    - "@river.task.deploy.naming.environment_strategy"
                    - "@kernel"
                    - "@jms_serializer"
                    - "@river.flow.environment_client.callback"
                - River\Task\RunContext:
                    - "@kernel"
                    - "@river.pipe_client"
                    - "@jms_serializer"
                - River\NotificationsContext:
                    - "@river.notifications.notifier.slack.traceable"
                - River\DevelopmentEnvironmentContext:
                    - "@kernel"
                    - "@event_bus"
                - River\LoggingContext:
                    - "@kernel"
                    - "@log_stream.client.in_memory"
                    - "@logger"

        pipe:
            paths:
                - %paths.base%/features/pipe/

            contexts:
                - Pipe\ApiContext:
                    - "@security.token_storage"
                    - "@app.repository.user"
                    - "@kernel"
                - Pipe\SecurityContext:
                    - "@app.repository.credentials_bucket"
                    - "@jms_serializer"
                    - "@app.repository.team"
                    - "@security.vaults.within_clusters.previously_known"
                    - "@pipe.adapter.kubernetes.traceable.role_binding_repository"
                    - "@pipe.adapter.kubernetes.in_memory.role_binding_repository"
                    - "@pipe.adapter.kubernetes.traceable.network_policy_repository"
                    - "@pipe.adapter.kubernetes.in_memory.network_policy_repository"
                - Pipe\EnvironmentContext:
                    - "@pipe.event_store"
                    - "@pipe.view.deployment_repository"
                    - "@event_bus"
                    - "@pipe.adapter.kubernetes.hookable.namespace_repository"
                    - "@lexik_jwt_authentication.jwt_manager"
                    - "@pipe.client"
                    - "@jms_serializer"
                    - "@app.repository.team"
                - Pipe\DeploymentContext:
                    - "@pipe.view.deployment_repository"
                    - "@pipe.event_store"
                    - "@event_bus"
                    - "@jms_serializer"
                    - "@pipe.client"
                - Pipe\NotificationContext:
                    - "@pipe.notification.notifier.traceable"
                    - "@pipe.notification.notifier.hookable"
                - Pipe\Kubernetes\NamespaceContext:
                    - "@pipe.adapter.kubernetes.traceable.namespace_repository"
                    - "@event_bus"
                    - "@pipe.adapter.kubernetes.traceable.secret_repository"
                    - "@pipe.adapter.kubernetes.traceable.service_account_repository"
                    - "@log_stream.logger_factory"
                    - "@pipe.adapter.kubernetes.in_memory.service_account_repository"
                    - "@pipe.adapter.kubernetes.in_memory.secret_repository"
                    - "@pipe.adapter.kubernetes.hookable.service_account_repository"
                    - "@pipe.adapter.kubernetes.hookable.namespace_repository"
                - Pipe\Kubernetes\ServiceContext:
                    - "@pipe.adapter.kubernetes.hookable.service_repository"
                    - "@pipe.adapter.kubernetes.traceable.service_repository"
                - Pipe\Kubernetes\IngressContext:
                    - "@pipe.adapter.kubernetes.traceable.ingress_repository"
                    - "@pipe.adapter.kubernetes.hookable.ingress_repository"
                    - "@pipe.adapter.kubernetes.in_memory.ingress_repository"
                - Pipe\Kubernetes\ReplicationControllerContext:
                    - "@pipe.adapter.kubernetes.traceable.replication_controller_repository"
                    - "@pipe.adapter.kubernetes.in_memory.pod_repository"
                    - "@pipe.adapter.kubernetes.traceable.pod_repository"
                - Pipe\Kubernetes\Mock\ReplicationControllerContext:
                    - "@pipe.adapter.kubernetes.hookable.replication_controller_repository"
                    - "@pipe.adapter.kubernetes.hookable.pod_repository"
                - Pipe\CloudFlareContext:
                    - "@pipe.cloud_flare.client.traceable"
                    - "@pipe.cloud_flare.client.api"
                - Pipe\HttpLabsContext:
                    - "@pipe.httplabs.http_client.handler.matching"
                    - "@pipe.httplabs.client.traceable"
                - Pipe\LogContext:
                    - "@logger"
                    - "@log_stream.hookable_factory"

        authenticator:
            paths:
                - %paths.base%/features/authenticator/

            contexts:
                - Authenticator\SmokeContext:
                    - "@doctrine.orm.entity_manager"
                - Authenticator\SecurityContext:
                    - "@app.security.user_provider"
                    - "@security.token_storage"
                    - "@app.repository.security_user"
                    - "@app.security.api_key.system_user_by_api_key"
                    - "@event_dispatcher"
                    - "@hwi_oauth.resource_owner.github"
                    - "@kernel"
                    - "@app.security.api_key.user_by_api_key_repository"
                    - "@session"
                    - "@test.http_client"
                    - "@app.repository.team"
                - Authenticator\UserContext:
                    - "@app.repository.security_user"
                    - "@app.repository.credentials_bucket"
                    - "@kernel"
                    - "@app.security.api_key.system_user_by_api_key"
                - Authenticator\CredentialsBucketContext:
                    - "@kernel"
                    - "@app.repository.credentials_bucket"
                - Authenticator\TeamContext:
                    - "@kernel"
                    - "@app.repository.team"
                    - "@app.repository.team_membership"
                    - "@app.repository.credentials_bucket"
                    - "@kube_status.http.middleware.predictable_request_mapping"
                - Authenticator\InvitationContext:
                    - "@kernel"
                    - "@app.repository.user_invitation"
                - Authenticator\AccountsContext:
                    - "@app.repository.account"
                    - "@kernel"
                    - "@google.http.middleware.predictable_request_mapping"
                    - "@app.repository.billing_profile"
                    - "@app.billing.plan_repository"
                - Authenticator\SubscriptionContext:
                    - "@kernel"

    extensions:
        Behat\Symfony2Extension:
            kernel:
                env: smoke_test

    gherkin:
        filters:
            tags: "@smoke && ~@wip"
