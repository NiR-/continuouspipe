default:
    suites:
        domain:
            paths:
                - %paths.base%/features/domain/

            contexts:
                - SecurityContext:
                    - @security.token_storage
                    - @security.authenticator.client.in_memory
                    - @kernel
                    - @security.encryption.vault
                - TideConfigurationContext:
                    - @river.tide_configuration_factory
                - TideContext:
                    - @command_bus
                    - @event_bus
                    - @river.tide_event_store
                    - @river.tide_factory
                    - @river.view.tide_repository
                    - @kernel
                    - @continuouspipe.message.default.message_producer.traced
                    - @river.time_resolver.predictable
                    - @river.repository.tide
                    - @continuouspipe.message.default.message_producer.delayed_messages_buffer
                - Tide\TasksContext:
                    - @event_bus
                    - @river.repository.tide
                - LoggingContext:
                    - @kernel
                    - @log_stream.client
                    - @logger
                - CodeRepositoriesContext:
                    - @river.commit_resolver.predictable
                    - @event_bus
                    - @river.tide_event_store
                    - @river.code_repository.branch_query
                - FlowContext:
                    - @river.pipe_client.fake
                    - @river.hookable_pipe_client
                    - @river.pipe_client
                    - @kernel
                    - @river.repository.flow
                    - @repository_river.code_repository_repository
                    - @security.authenticator.client.in_memory
                    - @authenticator.team_repository
                    - @event_bus
                - Task\BuildContext:
                    - @builder.client
                    - @builder.client.traceable
                    - @builder.client.hookable
                    - @builder.client.faulty_api_simulator
                    - @river.tide_event_store
                    - @event_bus
                    - @kernel
                    - @jms_serializer
                    - @tolerance.metrics.publisher.statsd
                - Task\DeployContext:
                    - @river.tide_event_store
                    - @event_bus
                    - @river.pipe_client
                    - @river.task.deploy.naming.environment_strategy
                    - @kernel
                    - @jms_serializer
                - Task\RunContext:
                    - @kernel
                    - @river.pipe_client
                    - @jms_serializer
                - Task\WaitContext: ~
                - Task\ManualApprovalContext:
                    - @kernel
                - TeamContext:
                    - @kernel
                    - @authenticator.team_repository
                - TideSummaryContext:
                    - @kernel
                - AnalyticsContext:
                    - @river.keen.client.traceable
                    - @river.logitio.client.traceable
                - NotificationsContext:
                    - @river.notifications.notifier.slack.traceable
                - Task\WebHookContext:
                    - @river.web_hooks.client.traceable
                    - @river.web_hooks.client.hookable
                - ClusterHealthContext:
                    - @river.k8s_health_checker.http.guzzle_client.stack
                    - @kernel
                - FirebaseContext:
                    - @csa_guzzle.data_collector.history_bag
                - UserActivityContext:
                    - @river.user_activity.traceable_dispatcher
                    - @river.user_activity.middleware_supporting_dispatcher
                - DevelopmentEnvironmentContext:
                    - @kernel
                    - @event_bus
                - BranchContext:
                    - @command_bus

                # TBR:
                - GitHubContext:
                    - @kernel
                    - @river.notifications.notifier.github.commit_status.traceable
                    - @river.pull_request_resolver
                    - @river.pipe_client
                    - @river.tide_event_store
                    - @river.github.http_client
                    - @github.integration.in_memory_installation_repository
                    - @github.integration.traceable_installation_repository
                    - @github.integration.installation_repository
                    - @github.integration.traceable_installation_token_resolver
                    - @github.integration.installation_token_resolver.in_memory
                    - @github.integration.installation_token_resolver
                    - @repository_river.code_repository_repository
                    - @river.github.guzzle_http_client.handler.matching
                    - @river.code_repository.branch_query

                - StorageContext:
                    - @river.pipeline.view.storage
                    - @river.repository.flow

        github:
            paths:
                - %paths.base%/features/integrations/code-repositories/common/
                - %paths.base%/features/integrations/code-repositories/github/

            contexts:
                - CacheContext:
                    - @river.cache

                # GitHub-specific contexts
                - GitHubContext:
                    - @kernel
                    - @river.notifications.notifier.github.commit_status.traceable
                    - @river.pull_request_resolver
                    - @river.pipe_client
                    - @river.tide_event_store
                    - @river.github.http_client
                    - @github.integration.in_memory_installation_repository
                    - @github.integration.traceable_installation_repository
                    - @github.integration.installation_repository
                    - @github.integration.traceable_installation_token_resolver
                    - @github.integration.installation_token_resolver.in_memory
                    - @github.integration.installation_token_resolver
                    - @repository_river.code_repository_repository
                    - @river.github.guzzle_http_client.handler.matching
                    - @river.code_repository.branch_query

                # Common contexts
                - SecurityContext:
                    - @security.token_storage
                    - @security.authenticator.client.in_memory
                    - @kernel
                    - @security.encryption.vault
                - TideConfigurationContext:
                    - @river.tide_configuration_factory
                - TideContext:
                    - @command_bus
                    - @event_bus
                    - @river.tide_event_store
                    - @river.tide_factory
                    - @river.view.tide_repository
                    - @kernel
                    - @continuouspipe.message.default.message_producer.traced
                    - @river.time_resolver.predictable
                    - @river.repository.tide
                    - @continuouspipe.message.default.message_producer.delayed_messages_buffer
                - Tide\TasksContext:
                    - @event_bus
                    - @river.repository.tide
                - LoggingContext:
                    - @kernel
                    - @log_stream.client
                    - @logger
                - CodeRepositoriesContext:
                    - @river.commit_resolver.predictable
                    - @event_bus
                    - @river.tide_event_store
                    - @river.code_repository.branch_query
                - FlowContext:
                    - @river.pipe_client.fake
                    - @river.hookable_pipe_client
                    - @river.pipe_client
                    - @kernel
                    - @river.repository.flow
                    - @repository_river.code_repository_repository
                    - @security.authenticator.client.in_memory
                    - @authenticator.team_repository
                    - @event_bus
                - Task\BuildContext:
                    - @builder.client
                    - @builder.client.traceable
                    - @builder.client.hookable
                    - @builder.client.faulty_api_simulator
                    - @river.tide_event_store
                    - @event_bus
                    - @kernel
                    - @jms_serializer
                    - @tolerance.metrics.publisher.statsd
                - Task\DeployContext:
                    - @river.tide_event_store
                    - @event_bus
                    - @river.pipe_client
                    - @river.task.deploy.naming.environment_strategy
                    - @kernel
                    - @jms_serializer
                - Task\RunContext:
                    - @kernel
                    - @river.pipe_client
                    - @jms_serializer
                - Task\WaitContext: ~
                - Task\ManualApprovalContext:
                    - @kernel
                - TideSummaryContext:
                    - @kernel
                - AnalyticsContext:
                    - @river.logitio.client.traceable
                    - @river.keen.client.traceable
                - NotificationsContext:
                    - @river.notifications.notifier.slack.traceable
                - Task\WebHookContext:
                    - @river.web_hooks.client.traceable
                    - @river.web_hooks.client.hookable
                - ClusterHealthContext:
                    - @river.k8s_health_checker.http.guzzle_client.stack
                    - @kernel
                - FirebaseContext:
                    - @csa_guzzle.data_collector.history_bag
                - UserActivityContext:
                    - @river.user_activity.traceable_dispatcher
                    - @river.user_activity.middleware_supporting_dispatcher

        bitbucket:
            paths:
                - %paths.base%/features/integrations/code-repositories/common/
                - %paths.base%/features/integrations/code-repositories/bitbucket/

            contexts:
                # BitBucket-specific contexts
                - BitBucketContext:
                    - @river.code_repository.bitbucket.explorer.http_client.handler.matching
                    - @kernel
                    - @atlassian_addon.installation_repository.traceable
                    - @jms_serializer
                    - @river.bitbucket.client_factory
                    - @csa_guzzle.data_collector.history_bag
                    - @repository_river.code_repository_repository
                    - @river.code_repository.branch_query
                    - @river.pull_request_resolver

                # Common contexts
                - SecurityContext:
                    - @security.token_storage
                    - @security.authenticator.client.in_memory
                    - @kernel
                    - @security.encryption.vault
                - TideConfigurationContext:
                    - @river.tide_configuration_factory
                - TideContext:
                    - @command_bus
                    - @event_bus
                    - @river.tide_event_store
                    - @river.tide_factory
                    - @river.view.tide_repository
                    - @kernel
                    - @continuouspipe.message.default.message_producer.traced
                    - @river.time_resolver.predictable
                    - @river.repository.tide
                    - @continuouspipe.message.default.message_producer.delayed_messages_buffer
                - Tide\TasksContext:
                    - @event_bus
                    - @river.repository.tide
                - LoggingContext:
                    - @kernel
                    - @log_stream.client
                    - @logger
                - CodeRepositoriesContext:
                    - @river.commit_resolver.predictable
                    - @event_bus
                    - @river.tide_event_store
                    - @river.code_repository.branch_query
                - FlowContext:
                    - @river.pipe_client.fake
                    - @river.hookable_pipe_client
                    - @river.pipe_client
                    - @kernel
                    - @river.repository.flow
                    - @repository_river.code_repository_repository
                    - @security.authenticator.client.in_memory
                    - @authenticator.team_repository
                    - @event_bus
                - Task\BuildContext:
                    - @builder.client
                    - @builder.client.traceable
                    - @builder.client.hookable
                    - @builder.client.faulty_api_simulator
                    - @river.tide_event_store
                    - @event_bus
                    - @kernel
                    - @jms_serializer
                    - @tolerance.metrics.publisher.statsd
                - Task\DeployContext:
                    - @river.tide_event_store
                    - @event_bus
                    - @river.pipe_client
                    - @river.task.deploy.naming.environment_strategy
                    - @kernel
                    - @jms_serializer
                - Task\RunContext:
                    - @kernel
                    - @river.pipe_client
                    - @jms_serializer
                - Task\WaitContext: ~
                - Task\ManualApprovalContext:
                    - @kernel
                - TideSummaryContext:
                    - @kernel
                - AnalyticsContext:
                    - @river.logitio.client.traceable
                    - @river.keen.client.traceable
                - NotificationsContext:
                    - @river.notifications.notifier.slack.traceable
                - Task\WebHookContext:
                    - @river.web_hooks.client.traceable
                    - @river.web_hooks.client.hookable
                - ClusterHealthContext:
                    - @river.k8s_health_checker.http.guzzle_client.stack
                    - @kernel
                - FirebaseContext:
                    - @csa_guzzle.data_collector.history_bag
                - UserActivityContext:
                    - @river.user_activity.traceable_dispatcher
                    - @river.user_activity.middleware_supporting_dispatcher

    extensions:
        Behat\Symfony2Extension:
            kernel:
                env: test

    gherkin:
        filters:
            tags: "~@wip && ~@onlySmoke"

smoke:
    suites:
        application:
            contexts:
                - SecurityContext:
                    - @security.token_storage
                    - @security.authenticator.client.in_memory
                    - @kernel
                    - @security.encryption.vault
                - FlowContext:
                    - @river.pipe_client.fake
                    - @river.hookable_pipe_client
                    - @river.pipe_client
                    - @kernel
                    - @river.repository.flow
                    - @repository_river.code_repository_repository
                    - @security.authenticator.client.in_memory
                    - @authenticator.team_repository
                    - @event_bus
                - TideContext:
                    - @command_bus
                    - @event_bus
                    - @river.tide_event_store
                    - @river.tide_factory
                    - @river.view.tide_repository
                    - @kernel
                    - @continuouspipe.message.default.message_producer.traced
                    - @river.time_resolver.predictable
                    - @river.repository.tide
                    - @continuouspipe.message.default.message_producer.delayed_messages_buffer
                - GitHubContext:
                    - @kernel
                    - @river.notifications.notifier.github.commit_status.traceable
                    - @river.pull_request_resolver
                    - @river.pipe_client
                    - @river.tide_event_store
                    - @river.github.http_client
                    - @github.integration.in_memory_installation_repository
                    - @github.integration.traceable_installation_repository
                    - @github.integration.installation_repository
                    - @github.integration.traceable_installation_token_resolver
                    - @github.integration.installation_token_resolver.in_memory
                    - @github.integration.installation_token_resolver
                    - @repository_river.code_repository_repository
                    - @river.github.guzzle_http_client.handler.matching
                    - @river.code_repository.branch_query
                - CodeRepositoriesContext:
                    - @river.commit_resolver.predictable
                    - @event_bus
                    - @river.tide_event_store
                    - @river.code_repository.branch_query
                - TideConfigurationContext:
                    - @river.tide_configuration_factory
                - Tide\TasksContext:
                    - @event_bus
                    - @river.repository.tide
                - Task\BuildContext:
                    - @builder.client
                    - @builder.client.traceable
                    - @builder.client.hookable
                    - @builder.client.faulty_api_simulator
                    - @river.tide_event_store
                    - @event_bus
                    - @kernel
                    - @jms_serializer
                    - @tolerance.metrics.publisher.statsd
                - NotificationsContext:
                    - @river.notifications.notifier.slack.traceable
                - DevelopmentEnvironmentContext:
                    - @kernel
                    - @event_bus

    extensions:
        Behat\Symfony2Extension:
            kernel:
                env: smoke_test

    gherkin:
        filters:
            tags: "@smoke && ~@wip"
