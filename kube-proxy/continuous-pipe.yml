tasks:
    images:
        build:
            environment:
                - name: KUBE_PROXY_LISTEN_HTTPS
                  value: ${KUBE_PROXY_LISTEN_HTTPS}
                - name: KUBE_PROXY_LISTEN_ADDRESS
                  value: ${KUBE_PROXY_LISTEN_ADDRESS}
                - name: KUBE_PROXY_INSECURE_SKIP_VERIFY
                  value: ${KUBE_PROXY_INSECURE_SKIP_VERIFY}
                - name: KUBE_PROXY_AUTHENTICATOR_HOST
                  value: ${KUBE_PROXY_AUTHENTICATOR_HOST}
                - name: KUBE_PROXY_MASTER_API_KEY
                  value: ${KUBE_PROXY_MASTER_API_KEY}
            services:
                web:
                    image: docker.io/continuouspipe/kube-proxy
                    naming_strategy: sha1
    deployment:
            deploy:
                cluster: ${CLUSTER}
                environment:
                    name: '"kube-proxy-" ~ code_reference.branch'
                services:
                    web:
                        specification:
                            accessibility:
                                from_external: true
                            ports:
                              - 80
                        deployment_strategy:
                            readiness_probe:
                                type: tcp
                                port: 6379
                            liveness_probe:
                                initial_delay_seconds: 5
                                timeout_seconds: 5
                                period_seconds: 5
                                type: http
                                port: 80
                                path: /healthz
                        specification:
                            ports:
                                - 6379