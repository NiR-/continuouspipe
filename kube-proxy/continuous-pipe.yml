tasks:
    images:
        build:
            services:
                web:
                    image: docker.io/continuouspipe/kube-proxy
                    naming_strategy: sha1
    deployment:
        deploy:
            cluster: ${CLUSTER}
            environment:
                name: '"kube-proxy-" ~ code_reference.branch'
            services:
                web:
                    specification:
                        accessibility:
                            from_external: true
                        ports:
                            - 443
                        environment_variables:
                            - name: WILDCARD_SSL_CERT
                              value: ${WILDCARD_SSL_CERT}
                            - name: WILDCARD_SSL_KEY
                              value: ${WILDCARD_SSL_KEY}
                            - name: KUBE_PROXY_LISTEN_ADDRESS
                              value: ${KUBE_PROXY_LISTEN_ADDRESS}
                            - name: KUBE_PROXY_INSECURE_SKIP_VERIFY
                              value: ${KUBE_PROXY_INSECURE_SKIP_VERIFY}
                            - name: KUBE_PROXY_AUTHENTICATOR_HOST
                              value: ${KUBE_PROXY_AUTHENTICATOR_HOST}
                            - name: KUBE_PROXY_MASTER_API_KEY
                              value: ${KUBE_PROXY_MASTER_API_KEY}