#!/bin/bash

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

command -v melody >/dev/null 2>&1 || {
    echo "This script requires Melody (melody.sensiolabs.org) to be installed."

    read -p "Do you want us to install it for you? " -n 1 -r
    echo    # (optional) move to a new line
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        sudo sh -c "curl http://get.sensiolabs.org/melody.phar -o /usr/local/bin/melody && chmod a+x /usr/local/bin/melody"
    else
        exit 1
    fi
}

# Generates the .env file if not complete
melody run $DIR/helpers/dot-env-generator.php

echo "Starting the Docker containers"
docker-compose up

# TODO: Wait until containers are ready...

docker-compose exec api bash -c 'bin/console assetic:dump'
