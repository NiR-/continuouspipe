tasks:
    images:
        build:
            services:
                frontend:
                    image: docker.io/sroze/logstream-frontend
                api:
                    image: docker.io/sroze/logstream-api

    deploy:
        deploy:
            cluster: gke
            services:
                frontend:
                    endpoints:
                        -
                            name: https
                            type: NodePort
                            ssl_certificates:
                                -
                                    name: continuouspipeio
                                    cert: ${WILDCARD_SSL_CERT}
                                    key: ${WILDCARD_SSL_KEY}
                    specification:
                        accessibility:
                            from_external: true

                        environment_variables:
                            - name: LOG_STREAM_API_URL
                              value: https://api.logstream.continuouspipe.io

                api:
                    specification:
                        accessibility:
                            from_external: true

