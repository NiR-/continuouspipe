tasks:
    images:
        build:
            services:
                frontend:
                    image: docker.io/sroze/logstream-frontend
                api:
                    image: docker.io/sroze/logstream-api

    deploy:
        deploy:
            cluster: ${CLUSTER}
            services:
                frontend:
                    endpoints:
                        -
                            name: https
                            type: NodePort
                            ssl_certificates:
                                -
                                    name: continuouspipeio
                                    cert: ${WILDCARD_SSL_CERT}
                                    key: ${WILDCARD_SSL_KEY}
                    specification:
                        accessibility:
                            from_external: true

                        environment_variables:
                            - name: LOG_STREAM_API_URL
                              value: https://api.logstream.continuouspipe.io

                api:
                    endpoints:
                        -
                            name: api-https
                            type: NodePort
                            ssl_certificates:
                                -
                                    name: continuouspipeio
                                    cert: ${WILDCARD_SSL_CERT}
                                    key: ${WILDCARD_SSL_KEY}

                    specification:
                        environment_variables:
                            - name: SENTRY_DSN
                              value: http://22dc66c5a4d44fa29a4fde743816c1e7:f0b9a26df73f4c2299d163034bc84324@sentry.tools.sroze.io/13
